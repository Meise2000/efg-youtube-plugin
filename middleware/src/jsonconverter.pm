package jsonconverter;

#-----------------------------------------------------------------------------------------------
# Convert any perl object to a json string.
#-----------------------------------------------------------------------------------------------
sub toJson {
    my ($obj) = @_;

    if (!$obj) {
        return 'null';
    } elsif (ref $obj eq 'HASH') {
        return _hashToJson($obj);
    } elsif (ref $obj eq 'ARRAY') {
        return _arrayToJson($obj);
    } elsif (_isNumeric($obj) || _isBoolean($obj)) {
        return $obj;
    }
    return '"' . _quotValue($obj) . '"';
}

#-----------------------------------------------------------------------------------------------
# Quote a value for use in JSON
#-----------------------------------------------------------------------------------------------
sub _quotValue {
    my ($data) = @_;

    $data =~ s/"/\\"/g;

    return $data;
}

#-----------------------------------------------------------------------------------------------
# Is it a numeric value?
#-----------------------------------------------------------------------------------------------
sub _isNumeric {
    my ($data) = @_;

    return $data =~ m/[\-?\d\.]+$/;
}

#-----------------------------------------------------------------------------------------------
# Is it a boolean value?
#-----------------------------------------------------------------------------------------------
sub _isBoolean {
    my ($data) = @_;

    return $data eq 'false' || $data eq 'true';
}

#-----------------------------------------------------------------------------------------------
# Convert an array to a json string
#-----------------------------------------------------------------------------------------------
sub _arrayToJson {
    my ($array) = @_;

    my @mapped = map toJson($_), @$array;
    return '[' . join(',', @mapped) . ']';
}

#-----------------------------------------------------------------------------------------------
# Convert a hash to a json string.
#-----------------------------------------------------------------------------------------------
sub _hashToJson {
    my ($hash) = @_;

    my $value = join(',', map {'"' . $_ . '":' . toJson($hash->{$_}) } (sort keys %$hash));
    return '{' . $value . '}';
}

1;

#-----------------------------------------------------------------------------------------------
